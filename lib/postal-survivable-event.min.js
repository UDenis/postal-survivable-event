(function(t,n){"function"==typeof define&&define.amd?define(["lodash","postal"],function(e,o){return n(e,o,t)}):"object"==typeof module&&module.exports?module.exports=function(t){return n(require("lodash"),t,this)}:t.postal=n(t._,t.postal,t)})(this,function(t,n,e,o){function r(t){var e=t.channel||n.configuration.DEFAULT_CHANNEL,o=t.topic;i.store[e]=i.store[e]||{},i.store[e][o]=t}function u(t){var e=t.channel||n.configuration.DEFAULT_CHANNEL,o=t.topic;return(i.store[e]||{})[o]}var i={store:{}},s=n.publish;n.document=function(t){return r(t),s.apply(this,arguments)};var a=n.subscribe;return n.subscribe=function(t){var n=a.apply(this,arguments);return setTimeout(function(){var e=u(t);e&&n.invokeSubscriber(e.data,e)},0),n},n.ChannelDefinition.prototype.document=function(){var t,n={};"string"==typeof arguments[0]?(n.topic=arguments[0],n.data=arguments[1],t=arguments[2]):(n=arguments[0],t=arguments[1]),n.channel=this.channel,this.bus.document(n,t)},n});