(function(t,n){"function"==typeof define&&define.amd?define(["lodash","postal"],function(e,o){return n(e,o,t)}):"object"==typeof module&&module.exports?module.exports=function(t){return n(require("lodash"),t,this)}:t.postal=n(t._,t.postal,t)})(this,function(t,n,e,o){function r(t){var e=t.channel||n.configuration.DEFAULT_CHANNEL,o=t.topic;u.store[e]=u.store[e]||{},u.store[e][o]=t}function i(t){var e=t.channel||n.configuration.DEFAULT_CHANNEL,o=t.topic;return(u.store[e]||{})[o]}var u={store:{}},a=n.publish;n.document=function(t){return r(t),a.apply(this,arguments)},n.document.clear=function(t){if(t){var e=t.channel||n.configuration.DEFAULT_CHANNEL,o=t.topic;o?delete u.store[e][o]:delete u.store[e]}else u.store={}};var s=n.subscribe;return n.subscribe=function(t){function n(){var n=i(t);n&&e.invokeSubscriber(n.data,n)}var e=s.apply(this,arguments);return n(),e},n.ChannelDefinition.prototype.document=function(){var t,n={};"string"==typeof arguments[0]?(n.topic=arguments[0],n.data=arguments[1],t=arguments[2]):(n=arguments[0],t=arguments[1]),n.channel=this.channel,this.bus.document(n,t)},n});