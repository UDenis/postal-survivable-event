(function(n,t){"function"==typeof define&&define.amd?define(["lodash","postal"],function(e,o){return t(e,o,n)}):"object"==typeof module&&module.exports?module.exports=function(n){return t(require("lodash"),n,this)}:n.postal=t(n._,n.postal,n)})(this,function(n,t,e,o){function r(n){var e=n.channel||t.configuration.DEFAULT_CHANNEL,o=n.topic;i.store[e]=i.store[e]||{},i.store[e][o]=n}function u(n){var e=n.channel||t.configuration.DEFAULT_CHANNEL,o=n.topic;return(i.store[e]||{})[o]}var i={store:{}},s=t.publish;t.document=function(n){return r(n),s.apply(this,arguments)};var a=t.subscribe;return t.subscribe=function(n){var t=a.apply(this,arguments),e=u(n);return e&&t.invokeSubscriber(e.data,e),t},t.ChannelDefinition.prototype.document=function(){var n,t={};"string"==typeof arguments[0]?(t.topic=arguments[0],t.data=arguments[1],n=arguments[2]):(t=arguments[0],n=arguments[1]),t.channel=this.channel,this.bus.document(t,n)},t});